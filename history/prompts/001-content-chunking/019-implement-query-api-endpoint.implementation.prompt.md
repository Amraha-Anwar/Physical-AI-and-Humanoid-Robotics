---
id: 019
title: implement-query-api-endpoint
stage: implementation
date: 2025-12-07
surface: agent
model: gemini-2.0-flash-exp
feature: 001-content-chunking
branch: 001-content-chunking
user: user
command: /sp.implement
labels: ["implementation", "api-endpoint", "rag"]
links:
  spec: specs/001-content-chunking/spec.md
  ticket: null
  adr: null
  pr: null
files:
 - backend/dependencies.py
 - backend/api/query.py
tests:
  - null
---

## Prompt

/sp.implement P3.1 Query Engine Setup: Execute Task T037

Goal: Implement the FastAPI endpoint that receives a user query and triggers the RAG workflow via the QueryService.

Execute:
- T037 Implement the POST /api/query endpoint.

Constraint:
- The code must be placed in `backend/api/query.py`.
- The endpoint must use the `POST` method and the path `/query`.
- It must accept the user's query text (e.g., as a simple string or Pydantic model) in the request body.
- It must use FastAPI dependencies to obtain the `QueryService` instance.
- It must call the asynchronous `answer_question_async` method of the service.
- It must return the final text answer generated by the LLM.

## Response snapshot

Updated `backend/dependencies.py` to provide `get_query_service` dependency. Implemented `backend/api/query.py` with `/query` POST endpoint using `QueryService` to handle RAG requests.

## Outcome

- ‚úÖ Impact: Implemented the RAG query API endpoint.
- üß™ Tests: None run.
- üìÅ Files: Modified backend/dependencies.py, backend/api/query.py.
- üîÅ Next prompts: Register the new router in main.py (Task T038).
- üß† Reflection: Needed to update dependencies first to ensure proper dependency injection for the new service. Standard FastAPI pattern followed.

## Evaluation notes (flywheel)

- Failure modes observed: null
- Graders run and results (PASS/FAIL): PASS
- Prompt variant (if applicable): null
- Next experiment (smallest change to try): null
