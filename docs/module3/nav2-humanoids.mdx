---
sidebar_position: 3
title: "Nav2 for Humanoids"
---

# Nav2 for Humanoids: Path Planning & Balance

The **Navigation 2 (Nav2)** stack is the industry standard for moving robots. However, it was designed for wheeled robots (differential drive, ackermann). Adapting it for a biped requires careful tuning to prevent falling over.

## 3.1 The Navigation Stack

Nav2 consists of:
1.  **Global Planner**: Finds a path from A to B (e.g., A* or Dijkstra).
2.  **Local Planner (Controller)**: Follows that path while avoiding dynamic obstacles.
3.  **Costmaps**: 2D grids representing safe and unsafe areas.

## 3.2 Bipedal Constraints

A wheeled robot can spin in place instantly or stop on a dime. A humanoid cannot.
*   **Constraint 1: Acceleration Limits**. If a humanoid accelerates too fast, the *Zero Moment Point (ZMP)* leaves the support polygon (feet), and it tips over.
*   **Constraint 2: Turning Radius**. Humanoids usually turn by stepping in place or walking in a curve. Instant rotation is unstable.

### Configuring the Controller

We use the **Regulated Pure Pursuit** or **MPPI** controller but tune the limits conservatively.

Edit `nav2_params.yaml`:

```yaml
controller_server:
  ros__parameters:
    FollowPath:
      plugin: "nav2_regulated_pure_pursuit_controller::RegulatedPurePursuitController"
      desired_linear_vel: 0.2  # Slow walking speed
      max_linear_accel: 0.1    # Very low acceleration to maintain balance
      max_linear_decel: 0.1
      rotate_to_heading_min_angle: 0.785 # Don't rotate in place for small deviations
      use_velocity_scaled_lookahead_dist: true
```

## 3.3 Stability as a Cost Function

We don't write a ZMP solver here. Instead, we rely on the **low-level gait controller** (running on the robot's microcontroller or a separate ROS node) to handle the actual stepping.

Nav2's job is to send **safe velocity commands** (`cmd_vel`).
*   If Nav2 sends `linear.x = 1.0 m/s`, the robot will fall.
*   If Nav2 sends `linear.x = 0.2 m/s`, the gait controller can successfully execute the walk.

## 3.4 Integration with VSLAM

Nav2 needs a map and a pose.
*   **Map**: Provided by Isaac ROS VSLAM (Occupancy Grid).
*   **Pose**: Provided by Isaac ROS VSLAM (`/tf` map -> odom).

By linking Module 3.2 (VSLAM) with Module 3.3 (Nav2), we achieve **Autonomous Navigation**. You can now give a 2D Goal in RViz ("Go to the kitchen"), and the robot will plan a safe path and walk there slowly.
