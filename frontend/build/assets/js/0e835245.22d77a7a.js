"use strict";(globalThis.webpackChunkphysical_ai_humanoid_robotics_book=globalThis.webpackChunkphysical_ai_humanoid_robotics_book||[]).push([[921],{5680:(e,n,a)=>{a.d(n,{xA:()=>c,yg:()=>d});var t=a(6540);function r(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function i(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),a.push.apply(a,t)}return a}function l(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?i(Object(a),!0).forEach(function(n){r(e,n,a[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))})}return e}function o(e,n){if(null==e)return{};var a,t,r=function(e,n){if(null==e)return{};var a,t,r={},i=Object.keys(e);for(t=0;t<i.length;t++)a=i[t],n.indexOf(a)>=0||(r[a]=e[a]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(t=0;t<i.length;t++)a=i[t],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var p=t.createContext({}),s=function(e){var n=t.useContext(p),a=n;return e&&(a="function"==typeof e?e(n):l(l({},n),e)),a},c=function(e){var n=s(e.components);return t.createElement(p.Provider,{value:n},e.children)},g="mdxType",y={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},m=t.forwardRef(function(e,n){var a=e.components,r=e.mdxType,i=e.originalType,p=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),g=s(a),m=r,d=g["".concat(p,".").concat(m)]||g[m]||y[m]||i;return a?t.createElement(d,l(l({ref:n},c),{},{components:a})):t.createElement(d,l({ref:n},c))});function d(e,n){var a=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=a.length,l=new Array(i);l[0]=m;var o={};for(var p in n)hasOwnProperty.call(n,p)&&(o[p]=n[p]);o.originalType=e,o[g]="string"==typeof e?e:r,l[1]=o;for(var s=2;s<i;s++)l[s]=a[s];return t.createElement.apply(null,l)}return t.createElement.apply(null,a)}m.displayName="MDXCreateElement"},6175:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>p,contentTitle:()=>l,default:()=>y,frontMatter:()=>i,metadata:()=>o,toc:()=>s});var t=a(8168),r=(a(6540),a(5680));const i={sidebar_position:2,title:"Packages and rclpy"},l="Packages and rclpy",o={unversionedId:"module1/packages-rclpy",id:"module1/packages-rclpy",title:"Packages and rclpy",description:"Learning Objectives",source:"@site/docs/module1/02-packages-rclpy.mdx",sourceDirName:"module1",slug:"/module1/packages-rclpy",permalink:"/docs/module1/packages-rclpy",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/module1/02-packages-rclpy.mdx",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,title:"Packages and rclpy"},sidebar:"tutorialSidebar",previous:{title:"ROS 2 Architecture & Core Concepts",permalink:"/docs/module1/architecture-concepts"},next:{title:"Robot Modeling (URDF)",permalink:"/docs/module1/urdf-rviz2"}},p={},s=[{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"Introduction to ROS 2 Packages",id:"introduction-to-ros-2-packages",level:2},{value:"1. Creating a ROS 2 Python Package",id:"1-creating-a-ros-2-python-package",level:2},{value:"<code>package.xml</code>",id:"packagexml",level:3},{value:"<code>setup.py</code>",id:"setuppy",level:3},{value:"2. Implementing a Publisher Node (<code>talker</code>)",id:"2-implementing-a-publisher-node-talker",level:2},{value:"3. Implementing a Subscriber Node (<code>listener</code>)",id:"3-implementing-a-subscriber-node-listener",level:2},{value:"4. Building and Running the Package",id:"4-building-and-running-the-package",level:2},{value:"Conclusion",id:"conclusion",level:2}],c={toc:s},g="wrapper";function y({components:e,...n}){return(0,r.yg)(g,(0,t.A)({},c,n,{components:e,mdxType:"MDXLayout"}),(0,r.yg)("h1",{id:"packages-and-rclpy"},"Packages and ",(0,r.yg)("inlineCode",{parentName:"h1"},"rclpy")),(0,r.yg)("h2",{id:"learning-objectives"},"Learning Objectives"),(0,r.yg)("p",null,"Upon completing this chapter, you will be able to:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Create a new ROS 2 Python package using ",(0,r.yg)("inlineCode",{parentName:"li"},"colcon")," and ",(0,r.yg)("inlineCode",{parentName:"li"},"ros2 pkg create"),"."),(0,r.yg)("li",{parentName:"ul"},"Understand the purpose and structure of ",(0,r.yg)("inlineCode",{parentName:"li"},"package.xml")," for dependency management."),(0,r.yg)("li",{parentName:"ul"},"Implement a basic ROS 2 Publisher node in Python using ",(0,r.yg)("inlineCode",{parentName:"li"},"rclpy"),"."),(0,r.yg)("li",{parentName:"ul"},"Implement a basic ROS 2 Subscriber node in Python using ",(0,r.yg)("inlineCode",{parentName:"li"},"rclpy"),"."),(0,r.yg)("li",{parentName:"ul"},"Compile and run your new ROS 2 Python package.")),(0,r.yg)("h2",{id:"introduction-to-ros-2-packages"},"Introduction to ROS 2 Packages"),(0,r.yg)("p",null,"In ROS 2, code is organized into ",(0,r.yg)("strong",{parentName:"p"},"packages"),". A package is the fundamental unit of software organization in ROS 2, containing nodes, libraries, configuration files, and other resources. They facilitate code reuse and modular development."),(0,r.yg)("p",null,"Python is a popular choice for rapid prototyping and developing ROS 2 applications due to its readability and extensive libraries. The ",(0,r.yg)("inlineCode",{parentName:"p"},"rclpy")," client library is the Python interface for ROS 2, providing the necessary APIs to create nodes, publishers, subscribers, services, and actions."),(0,r.yg)("h2",{id:"1-creating-a-ros-2-python-package"},"1. Creating a ROS 2 Python Package"),(0,r.yg)("p",null,"We will use ",(0,r.yg)("inlineCode",{parentName:"p"},"colcon")," for building ROS 2 packages and ",(0,r.yg)("inlineCode",{parentName:"p"},"ros2 pkg create")," for package creation. ",(0,r.yg)("inlineCode",{parentName:"p"},"colcon")," is a command-line tool that orchestrates the build, test, and install processes of a set of packages."),(0,r.yg)("p",null,"First, let's create a new ",(0,r.yg)("inlineCode",{parentName:"p"},"colcon")," workspace to house our packages. A workspace is a directory where you store your ROS 2 packages and build them."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"# Create a colcon workspace\nmkdir -p ~/colcon_ws/src\ncd ~/colcon_ws/src\n")),(0,r.yg)("p",null,"Now, create a new Python package named ",(0,r.yg)("inlineCode",{parentName:"p"},"my_py_pkg"),":"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"ros2 pkg create --build-type ament_python my_py_pkg\n")),(0,r.yg)("p",null,"This command creates a directory structure like this:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},"colcon_ws/src/\n\u2514\u2500\u2500 my_py_pkg/\n    \u251c\u2500\u2500 my_py_pkg/\n    \u2502   \u2514\u2500\u2500 __init__.py\n    \u251c\u2500\u2500 package.xml\n    \u251c\u2500\u2500 setup.py\n    \u2514\u2500\u2500 resource/\n        \u2514\u2500\u2500 my_py_pkg\n")),(0,r.yg)("h3",{id:"packagexml"},(0,r.yg)("inlineCode",{parentName:"h3"},"package.xml")),(0,r.yg)("p",null,"The ",(0,r.yg)("inlineCode",{parentName:"p"},"package.xml")," file is crucial for defining metadata about your package, including its name, version, description, maintainers, license, and most importantly, its ",(0,r.yg)("strong",{parentName:"p"},"dependencies"),"."),(0,r.yg)("p",null,"Open ",(0,r.yg)("inlineCode",{parentName:"p"},"my_py_pkg/package.xml")," and ensure it has (or add) the following dependencies:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-xml"},"<dependency>rclpy</dependency>\n<dependency>std_msgs</dependency>\n")),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"rclpy"),": The Python client library for ROS 2."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"std_msgs"),": Contains standard message types (like ",(0,r.yg)("inlineCode",{parentName:"li"},"String"),", ",(0,r.yg)("inlineCode",{parentName:"li"},"Int32"),", etc.) that are commonly used.")),(0,r.yg)("h3",{id:"setuppy"},(0,r.yg)("inlineCode",{parentName:"h3"},"setup.py")),(0,r.yg)("p",null,"For Python packages, ",(0,r.yg)("inlineCode",{parentName:"p"},"setup.py")," is used by Python's ",(0,r.yg)("inlineCode",{parentName:"p"},"setuptools")," to define how the package is built and installed. When creating a Python package with ",(0,r.yg)("inlineCode",{parentName:"p"},"ros2 pkg create"),", a basic ",(0,r.yg)("inlineCode",{parentName:"p"},"setup.py")," is generated. We'll modify this file to declare our executable scripts (nodes)."),(0,r.yg)("h2",{id:"2-implementing-a-publisher-node-talker"},"2. Implementing a Publisher Node (",(0,r.yg)("inlineCode",{parentName:"h2"},"talker"),")"),(0,r.yg)("p",null,'A publisher node will periodically send messages to a topic. We\'ll create a simple "talker" node that publishes "Hello World" messages to a topic named ',(0,r.yg)("inlineCode",{parentName:"p"},"topic"),"."),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"Create the script:"),"\nCreate a file named ",(0,r.yg)("inlineCode",{parentName:"p"},"talker.py")," inside ",(0,r.yg)("inlineCode",{parentName:"p"},"my_py_pkg/my_py_pkg/")," directory:"),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"# Ensure you are in the my_py_pkg/my_py_pkg directory\ntouch ~/colcon_ws/src/my_py_pkg/my_py_pkg/talker.py\n"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"Add Python code to ",(0,r.yg)("inlineCode",{parentName:"strong"},"talker.py"),":")),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-python"},"import rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String\n\nclass MinimalPublisher(Node):\n\n    def __init__(self):\n        super().__init__('minimal_publisher')\n        self.publisher_ = self.create_publisher(String, 'topic', 10)\n        timer_period = 0.5  # seconds\n        self.timer = self.create_timer(timer_period, self.timer_callback)\n        self.i = 0\n\n    def timer_callback(self):\n        msg = String()\n        msg.data = 'Hello World: %d' % self.i\n        self.publisher_.publish(msg)\n        self.get_logger().info('Publishing: \"%s\"' % msg.data)\n        self.i += 1\n\ndef main(args=None):\n    rclpy.init(args=args)\n\n    minimal_publisher = MinimalPublisher()\n\n    rclpy.spin(minimal_publisher)\n\n    # Destroy the node explicitly\n    # (optional - otherwise it will be done automatically\n    # when the garbage collector destroys the node object)\n    minimal_publisher.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"Declare the executable in ",(0,r.yg)("inlineCode",{parentName:"strong"},"setup.py"),":"),"\nOpen ",(0,r.yg)("inlineCode",{parentName:"p"},"~/colcon_ws/src/my_py_pkg/setup.py")," and add the ",(0,r.yg)("inlineCode",{parentName:"p"},"entry_points")," section inside ",(0,r.yg)("inlineCode",{parentName:"p"},"setup()")," function's ",(0,r.yg)("inlineCode",{parentName:"p"},"kwargs")," (usually after ",(0,r.yg)("inlineCode",{parentName:"p"},"zip_safe=True"),"):"),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-python"},"# ... other imports and setup config ...\n\nentry_points={\n    'console_scripts': [\n        'talker = my_py_pkg.talker:main',\n    ],\n},\n")),(0,r.yg)("p",{parentName:"li"},"This tells ",(0,r.yg)("inlineCode",{parentName:"p"},"colcon")," to create an executable named ",(0,r.yg)("inlineCode",{parentName:"p"},"talker")," that runs the ",(0,r.yg)("inlineCode",{parentName:"p"},"main")," function from ",(0,r.yg)("inlineCode",{parentName:"p"},"my_py_pkg.talker")," module."))),(0,r.yg)("h2",{id:"3-implementing-a-subscriber-node-listener"},"3. Implementing a Subscriber Node (",(0,r.yg)("inlineCode",{parentName:"h2"},"listener"),")"),(0,r.yg)("p",null,'A subscriber node will listen for messages on a topic. We\'ll create a simple "listener" node that subscribes to the ',(0,r.yg)("inlineCode",{parentName:"p"},"topic")," and prints the received messages."),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"Create the script:"),"\nCreate a file named ",(0,r.yg)("inlineCode",{parentName:"p"},"listener.py")," inside ",(0,r.yg)("inlineCode",{parentName:"p"},"my_py_pkg/my_py_pkg/")," directory:"),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"# Ensure you are in the my_py_pkg/my_py_pkg directory\ntouch ~/colcon_ws/src/my_py_pkg/my_py_pkg/listener.py\n"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"Add Python code to ",(0,r.yg)("inlineCode",{parentName:"strong"},"listener.py"),":")),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-python"},"import rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String\n\nclass MinimalSubscriber(Node):\n\n    def __init__(self):\n        super().__init__('minimal_subscriber')\n        self.subscription = self.create_subscription(\n            String,\n            'topic',\n            self.listener_callback,\n            10)\n        self.subscription  # prevent unused variable warning\n\n    def listener_callback(self, msg):\n        self.get_logger().info('I heard: \"%s\"' % msg.data)\n\ndef main(args=None):\n    rclpy.init(args=args)\n\n    minimal_subscriber = MinimalSubscriber()\n\n    rclpy.spin(minimal_subscriber)\n\n    # Destroy the node explicitly\n    # (optional - otherwise it will be done automatically\n    # when the garbage collector destroys the node object)\n    minimal_subscriber.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"Declare the executable in ",(0,r.yg)("inlineCode",{parentName:"strong"},"setup.py"),":"),"\nOpen ",(0,r.yg)("inlineCode",{parentName:"p"},"~/colcon_ws/src/my_py_pkg/setup.py")," again and add the ",(0,r.yg)("inlineCode",{parentName:"p"},"listener")," executable to the ",(0,r.yg)("inlineCode",{parentName:"p"},"console_scripts")," entry points:"),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-python"},"# ... other imports and setup config ...\n\nentry_points={\n    'console_scripts': [\n        'talker = my_py_pkg.talker:main',\n        'listener = my_py_pkg.listener:main', # Add this line\n    ],\n},\n")))),(0,r.yg)("h2",{id:"4-building-and-running-the-package"},"4. Building and Running the Package"),(0,r.yg)("p",null,"Now that we have our ",(0,r.yg)("inlineCode",{parentName:"p"},"talker")," and ",(0,r.yg)("inlineCode",{parentName:"p"},"listener")," nodes defined, let's build the package and run them."),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"Navigate to the workspace root and build:")),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"cd ~/colcon_ws\ncolcon build --packages-select my_py_pkg\n")),(0,r.yg)("p",{parentName:"li"},"If the build is successful, you will see output indicating that ",(0,r.yg)("inlineCode",{parentName:"p"},"my_py_pkg")," was built.")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"Source the workspace:"),'\nAfter building, you need to "source" the workspace to make the new executables available in your current shell.'),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"source install/setup.bash\n")),(0,r.yg)("p",{parentName:"li"},(0,r.yg)("em",{parentName:"p"},"(Remember to source this every time you open a new terminal or add it to your ",(0,r.yg)("inlineCode",{parentName:"em"},"~/.bashrc"),")"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"Run the ",(0,r.yg)("inlineCode",{parentName:"strong"},"talker")," node:"),"\nOpen a new terminal, source your workspace, and run the talker:"),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"source ~/colcon_ws/install/setup.bash\nros2 run my_py_pkg talker\n")),(0,r.yg)("p",{parentName:"li"},'You should see the talker publishing "Hello World" messages.')),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"Run the ",(0,r.yg)("inlineCode",{parentName:"strong"},"listener")," node:"),"\nOpen ",(0,r.yg)("em",{parentName:"p"},"another")," new terminal, source your workspace, and run the listener:"),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"source ~/colcon_ws/install/setup.bash\nros2 run my_py_pkg listener\n")),(0,r.yg)("p",{parentName:"li"},"You should see the listener node printing the messages received from the talker. This demonstrates successful inter-node communication via ROS 2 topics."))),(0,r.yg)("h2",{id:"conclusion"},"Conclusion"),(0,r.yg)("p",null,"You have successfully created a ROS 2 Python package, defined its dependencies, implemented basic publisher and subscriber nodes using ",(0,r.yg)("inlineCode",{parentName:"p"},"rclpy"),", and verified their communication. This forms the foundation for more complex robotic behaviors and data processing within the ROS 2 ecosystem."),(0,r.yg)("hr",null),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"Next Steps"),": Building upon this understanding, the next chapter will introduce how to define and simulate robot kinematics and dynamics using the Unified Robot Description Format (URDF) and visualize them in ",(0,r.yg)("inlineCode",{parentName:"p"},"rviz2"),"."))}y.isMDXComponent=!0}}]);